<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Hybrid Single-Arm to Multi-Arm Bayesian Adaptive Trial Design Specification • evolveTrial</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Hybrid Single-Arm to Multi-Arm Bayesian Adaptive Trial Design Specification"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">evolveTrial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/design-overview.html">design-overview</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hybrid Single-Arm to Multi-Arm Bayesian Adaptive Trial Design Specification</h1>

    </div>

<div id="hybrid-single-arm-to-multi-arm-bayesian-adaptive-trial-design-specification" class="section level1">

<p><strong>Version</strong>: 1.0 <strong>Date</strong>: 2025-12-20 <strong>Status</strong>: Approved for Implementation</p>
<hr><div class="section level2">
<h2 id="id_1-design-overview">1. Design Overview<a class="anchor" aria-label="anchor" href="#id_1-design-overview"></a></h2>
<div class="section level3">
<h3 id="id_11-purpose">1.1 Purpose<a class="anchor" aria-label="anchor" href="#id_11-purpose"></a></h3>
<p>This specification defines a hybrid trial design for evolveTrial that: 1. Begins with <strong>single-arm (SA) monitoring</strong> of each experimental arm against pre-specified historical controls 2. Upon meeting SA efficacy criteria, evaluates <strong>conversion</strong> to a between-arm (BA) comparison 3. Uses <strong>predictive probability</strong> to determine if additional enrollment for BA comparison is worthwhile 4. If converted, continues with <strong>seamless</strong> BA monitoring using all accumulated data</p>
</div>
<div class="section level3">
<h3 id="id_12-key-design-decisions">1.2 Key Design Decisions<a class="anchor" aria-label="anchor" href="#id_12-key-design-decisions"></a></h3>
<table class="table"><colgroup><col width="34%"><col width="27%"><col width="37%"></colgroup><thead><tr class="header"><th>Decision</th>
<th>Choice</th>
<th>Rationale</th>
</tr></thead><tbody><tr class="odd"><td>SA efficacy criteria</td>
<td>Configurable: “any”, “all”, or “k_of_K”</td>
<td>Flexibility for different trial contexts</td>
</tr><tr class="even"><td>Sample size method</td>
<td>Both predictive AND posterior</td>
<td>Predictive for production, posterior for fast prototyping</td>
</tr><tr class="odd"><td>SA futility handling</td>
<td>Configurable: “stop_trial”, “drop_arm”, “continue”</td>
<td>Per-arm flexibility</td>
</tr><tr class="even"><td>Data use after conversion</td>
<td>Seamless (use all data)</td>
<td>FDA-accepted, maximizes information</td>
</tr><tr class="odd"><td>Survival model</td>
<td>Piecewise exponential (PWE)</td>
<td>Matches evolveTrial, handles non-constant hazards</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_13-literature-foundation">1.3 Literature Foundation<a class="anchor" aria-label="anchor" href="#id_13-literature-foundation"></a></h3>
<ul><li>
<strong>BASIC Design</strong> (Thall et al. 2023) - Bayesian adaptive synthetic-control</li>
<li>
<strong>MAMS Literature</strong> - Multi-arm multi-stage seamless designs</li>
<li>
<strong>SSR Literature</strong> - Predictive probability for sample size re-estimation (Chuang-Stein 2007)</li>
<li>
<strong>FDA Guidance</strong> (2019) - Adaptive designs with prospective specification</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="id_2-mathematical-framework">2. Mathematical Framework<a class="anchor" aria-label="anchor" href="#id_2-mathematical-framework"></a></h2>
<div class="section level3">
<h3 id="id_21-survival-model">2.1 Survival Model<a class="anchor" aria-label="anchor" href="#id_21-survival-model"></a></h3>
<p><strong>Piecewise Exponential (PWE)</strong> with K intervals: - Hazard rates: λ_k for arm k, interval j - Gamma conjugate priors: λ_{k,j} ~ Gamma(α_0, β_0)</p>
<p><strong>Posterior Update</strong>:</p>
<pre><code><span><span class="va">α_post</span> <span class="op">=</span> <span class="va">α_prior</span> <span class="op">+</span> <span class="va">n_events</span></span>
<span><span class="va">β_post</span> <span class="op">=</span> <span class="va">β_prior</span> <span class="op">+</span> <span class="va">person_time</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="id_22-historical-control">2.2 Historical Control<a class="anchor" aria-label="anchor" href="#id_22-historical-control"></a></h3>
<p>Historical control hazard is a <strong>fixed constant</strong> (not modeled as random):</p>
<pre><code><span><span class="va">λ_hist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">median_hist</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="id_23-within-arm-comparison-vs-historical">2.3 Within-Arm Comparison (vs Historical)<a class="anchor" aria-label="anchor" href="#id_23-within-arm-comparison-vs-historical"></a></h3>
<p>Probability that arm k beats historical by threshold c_k:</p>
<pre><code>p_k^single = P(λ_k &lt; c_k × λ_hist | data)</code></pre>
<p>For exponential (K=1): <strong>Closed-form Gamma CDF</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">pgamma</a></span><span class="op">(</span><span class="va">c_k</span> <span class="op">*</span> <span class="va">lambda_hist</span>, shape <span class="op">=</span> <span class="va">a_post</span>, rate <span class="op">=</span> <span class="va">b_post</span><span class="op">)</span></span></code></pre></div>
<p>For PWE (K&gt;1): <strong>Posterior sampling</strong> using existing evolveTrial infrastructure</p>
</div>
<div class="section level3">
<h3 id="id_24-between-arm-comparison">2.4 Between-Arm Comparison<a class="anchor" aria-label="anchor" href="#id_24-between-arm-comparison"></a></h3>
<p>Probability that arm A is superior to arm B:</p>
<pre><code><span><span class="va">p_AB</span><span class="op">^</span><span class="va">between</span> <span class="op">=</span> <span class="fu">P</span><span class="op">(</span><span class="va">λ_A</span> <span class="op">/</span> <span class="va">λ_B</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">data</span><span class="op">)</span></span></code></pre>
<p>For exponential: <strong>Closed-form F-distribution</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_between</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">pf</a></span><span class="op">(</span></span>
<span>  q <span class="op">=</span> <span class="op">(</span><span class="va">b_A</span> <span class="op">/</span> <span class="va">b_B</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">a_B</span> <span class="op">/</span> <span class="va">a_A</span><span class="op">)</span>,</span>
<span>  df1 <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">a_A</span>,</span>
<span>  df2 <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">a_B</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For PWE: <strong>Posterior sampling</strong> using <code><a href="reference/sample_vs_ref_medians_ph.html">sample_vs_ref_medians_ph()</a></code></p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_3-state-machine-architecture">3. State Machine Architecture<a class="anchor" aria-label="anchor" href="#id_3-state-machine-architecture"></a></h2>
<div class="section level3">
<h3 id="id_31-states">3.1 States<a class="anchor" aria-label="anchor" href="#id_31-states"></a></h3>
<pre><code><span><span class="va">STATE_SINGLE</span>              <span class="co"># Primary SA monitoring</span></span>
<span><span class="va">STATE_CONSIDER_CONVERSION</span> <span class="co"># Evaluating conversion via PP</span></span>
<span><span class="va">STATE_BETWEEN</span>             <span class="co"># Full BA comparison phase</span></span>
<span><span class="va">STATE_STOP</span>                <span class="co"># Terminal state</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="id_32-transitions">3.2 Transitions<a class="anchor" aria-label="anchor" href="#id_32-transitions"></a></h3>
<pre><code>                    ┌─────────────────┐
                    │  STATE_SINGLE   │
                    └────────┬────────┘
                             │
          ┌──────────────────┼──────────────────┐
          │                  │                  │
          ▼                  ▼                  ▼
  ┌────────────────┐ ┌────────────────┐ ┌─────────────────────┐
  │ All arms       │ │ Max N reached  │ │ SA trigger met      │
  │ futile         │ │ (no trigger)   │ │                     │
  └───────┬────────┘ └───────┬────────┘ └──────────┬──────────┘
          │                  │                     │
          │                  │                     ▼
          │                  │          ┌─────────────────────────┐
          │                  │          │ STATE_CONSIDER_CONVERSION│
          │                  │          └──────────┬──────────────┘
          │                  │                     │
          │                  │         ┌───────────┴───────────┐
          │                  │         │                       │
          │                  │         ▼                       ▼
          │                  │  ┌─────────────┐         ┌──────────┐
          │                  │  │ PP &gt;= pp_go │         │PP &lt; nogo │
          │                  │  └──────┬──────┘         └────┬─────┘
          │                  │         │                     │
          │                  │         ▼                     │
          │                  │  ┌─────────────────┐          │
          │                  │  │  STATE_BETWEEN  │          │
          │                  │  └────────┬────────┘          │
          │                  │           │                   │
          ▼                  ▼           ▼                   ▼
       ┌────────────────────────────────────────────────────────┐
       │                        STATE_STOP                      │
       └────────────────────────────────────────────────────────┘</code></pre>
</div>
<div class="section level3">
<h3 id="id_33-state-logic">3.3 State Logic<a class="anchor" aria-label="anchor" href="#id_33-state-logic"></a></h3>
<p><strong>STATE_SINGLE</strong>: - Enroll patients, compute SA posteriors at each interim - Check SA efficacy: <code>p_k^single &gt; eff_sa</code> - Check SA futility: <code>p_k^single &lt; fut_sa</code> - Apply futility action per arm configuration - Check transition trigger</p>
<p><strong>STATE_CONSIDER_CONVERSION</strong>: - Compute PP curve for candidate N_add values - If <code>PP(N_add) &gt;= pp_go</code> for some viable N → proceed - If <code>max(PP) &lt; pp_nogo</code> → stop (not worth continuing) - Else: ambiguous region (default to no-go)</p>
<p><strong>STATE_BETWEEN</strong>: - Continue enrollment to selected N_max - Check BA efficacy: <code>p_AB^between &gt; eff_ba</code> - Check BA futility: <code>p_AB^between &lt; fut_ba</code></p>
<p><strong>STATE_STOP</strong>: - Report single-arm and/or between-arm conclusions</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_4-decision-rules">4. Decision Rules<a class="anchor" aria-label="anchor" href="#id_4-decision-rules"></a></h2>
<div class="section level3">
<h3 id="id_41-single-arm-rules">4.1 Single-Arm Rules<a class="anchor" aria-label="anchor" href="#id_41-single-arm-rules"></a></h3>
<table class="table"><colgroup><col width="24%"><col width="44%"><col width="32%"></colgroup><thead><tr class="header"><th>Rule</th>
<th>Condition</th>
<th>Action</th>
</tr></thead><tbody><tr class="odd"><td>SA Efficacy</td>
<td><code>P(HR &lt; c_k | data) &gt; eff_sa</code></td>
<td>Mark arm as SA-successful</td>
</tr><tr class="even"><td>SA Futility</td>
<td><code>P(HR &lt; c_k | data) &lt; fut_sa</code></td>
<td>Apply futility_action</td>
</tr></tbody></table><p><strong>Default thresholds</strong>: - <code>eff_sa = 0.90</code> - <code>fut_sa = 0.10</code> - <code>c_k = 0.80</code> (20% improvement target)</p>
</div>
<div class="section level3">
<h3 id="id_42-transition-triggers">4.2 Transition Triggers<a class="anchor" aria-label="anchor" href="#id_42-transition-triggers"></a></h3>
<table class="table"><thead><tr class="header"><th>Trigger</th>
<th>Condition</th>
</tr></thead><tbody><tr class="odd"><td><code>any_single_success</code></td>
<td>At least 1 arm has SA efficacy</td>
</tr><tr class="even"><td><code>all_single_success</code></td>
<td>All active arms have SA efficacy</td>
</tr><tr class="odd"><td><code>k_of_K</code></td>
<td>At least k of K arms have SA efficacy</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_43-conversion-rules">4.3 Conversion Rules<a class="anchor" aria-label="anchor" href="#id_43-conversion-rules"></a></h3>
<table class="table"><colgroup><col width="34%"><col width="37%"><col width="27%"></colgroup><thead><tr class="header"><th>Decision</th>
<th>Condition</th>
<th>Action</th>
</tr></thead><tbody><tr class="odd"><td>GO</td>
<td>
<code>PP(N_add) &gt;= pp_go</code> for viable N</td>
<td>Proceed to STATE_BETWEEN</td>
</tr><tr class="even"><td>NO-GO</td>
<td><code>max(PP) &lt; pp_nogo</code></td>
<td>Stop with SA conclusions</td>
</tr><tr class="odd"><td>AMBIGUOUS</td>
<td><code>pp_nogo &lt;= max(PP) &lt; pp_go</code></td>
<td>Default to NO-GO (configurable)</td>
</tr></tbody></table><p><strong>Default thresholds</strong>: - <code>pp_go = 0.70</code> - <code>pp_nogo = 0.20</code></p>
</div>
<div class="section level3">
<h3 id="id_44-between-arm-rules">4.4 Between-Arm Rules<a class="anchor" aria-label="anchor" href="#id_44-between-arm-rules"></a></h3>
<table class="table"><thead><tr class="header"><th>Rule</th>
<th>Condition</th>
<th>Action</th>
</tr></thead><tbody><tr class="odd"><td>BA Efficacy</td>
<td><code>P(HR_AB &lt; 1 | data) &gt; eff_ba</code></td>
<td>Declare BA efficacy</td>
</tr><tr class="even"><td>BA Futility</td>
<td><code>P(HR_AB &lt; 1 | data) &lt; fut_ba</code></td>
<td>Declare BA futility</td>
</tr></tbody></table><p><strong>Default thresholds</strong>: - <code>eff_ba = 0.975</code> - <code>fut_ba = 0.05</code></p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_5-sample-size-re-estimation">5. Sample Size Re-Estimation<a class="anchor" aria-label="anchor" href="#id_5-sample-size-re-estimation"></a></h2>
<div class="section level3">
<h3 id="id_51-predictive-probability-method-recommended">5.1 Predictive Probability Method (Recommended)<a class="anchor" aria-label="anchor" href="#id_51-predictive-probability-method-recommended"></a></h3>
<p><strong>Algorithm</strong>:</p>
<pre><code>For each candidate N_add in {10, 20, ..., max_additional_n}:
  success_count = 0
  For i = 1 to n_outer (default 1000):
    1. Draw λ_true from current posterior
    2. Simulate future patients under λ_true
    3. Update posterior with future data (seamless)
    4. Compute P(BA success | final data)
    5. If P(BA success) &gt;= eff_ba: success_count++
  PP(N_add) = success_count / n_outer

Find smallest N_add where PP(N_add) &gt;= pp_go</code></pre>
<p><strong>Properties</strong>: - Accounts for posterior uncertainty - Bayesian-consistent - More conservative than conditional power</p>
</div>
<div class="section level3">
<h3 id="id_52-posterior-method-fast-approximation">5.2 Posterior Method (Fast Approximation)<a class="anchor" aria-label="anchor" href="#id_52-posterior-method-fast-approximation"></a></h3>
<p><strong>Algorithm</strong>:</p>
<pre><code>1. Extract point estimate θ̂ from current posterior mode
2. For each candidate N_add:
   Calculate conditional power: CP(N_add | θ̂)
3. Find smallest N_add where CP &gt;= target_power</code></pre>
<p><strong>Properties</strong>: - Analytical (milliseconds) - Can be overconfident with sparse data - Use for rapid prototyping only</p>
</div>
<div class="section level3">
<h3 id="id_53-recommendation">5.3 Recommendation<a class="anchor" aria-label="anchor" href="#id_53-recommendation"></a></h3>
<p>Use <strong>predictive probability</strong> for production calibration and final design selection. Use <strong>posterior method</strong> for quick feasibility checks during development.</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_6-key-parameters">6. Key Parameters<a class="anchor" aria-label="anchor" href="#id_6-key-parameters"></a></h2>
<div class="section level3">
<h3 id="id_61-phase-1-single-arm">6.1 Phase 1 (Single-Arm)<a class="anchor" aria-label="anchor" href="#id_61-phase-1-single-arm"></a></h3>
<table class="table"><colgroup><col width="22%"><col width="16%"><col width="14%"><col width="18%"><col width="27%"></colgroup><thead><tr class="header"><th>Parameter</th>
<th>Symbol</th>
<th>Range</th>
<th>Default</th>
<th>Description</th>
</tr></thead><tbody><tr class="odd"><td>SA efficacy</td>
<td>eff_sa</td>
<td>[0.80, 0.99]</td>
<td>0.90</td>
<td>Posterior prob threshold for SA efficacy</td>
</tr><tr class="even"><td>SA futility</td>
<td>fut_sa</td>
<td>[0.01, 0.20]</td>
<td>0.10</td>
<td>Posterior prob threshold for SA futility</td>
</tr><tr class="odd"><td>HR threshold</td>
<td>c_k</td>
<td>[0.60, 0.90]</td>
<td>0.80</td>
<td>Target HR vs historical</td>
</tr><tr class="even"><td>Min events</td>
<td>ev_sa</td>
<td>[5, 25]</td>
<td>15</td>
<td>Minimum events before SA interim</td>
</tr><tr class="odd"><td>Max N</td>
<td>nmax_sa</td>
<td>[30, 80]</td>
<td>40</td>
<td>Maximum N in SA phase per arm</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_62-conversion">6.2 Conversion<a class="anchor" aria-label="anchor" href="#id_62-conversion"></a></h3>
<table class="table"><colgroup><col width="22%"><col width="16%"><col width="14%"><col width="18%"><col width="27%"></colgroup><thead><tr class="header"><th>Parameter</th>
<th>Symbol</th>
<th>Range</th>
<th>Default</th>
<th>Description</th>
</tr></thead><tbody><tr class="odd"><td>PP go</td>
<td>pp_go</td>
<td>[0.50, 0.90]</td>
<td>0.70</td>
<td>PP threshold to proceed to BA</td>
</tr><tr class="even"><td>PP no-go</td>
<td>pp_nogo</td>
<td>[0.10, 0.40]</td>
<td>0.20</td>
<td>PP threshold to stop</td>
</tr><tr class="odd"><td>Trigger</td>
<td>trigger</td>
<td>categorical</td>
<td>“any”</td>
<td>“any”, “all”, or “k_of_K”</td>
</tr><tr class="even"><td>Max additional N</td>
<td>max_add_n</td>
<td>[30, 100]</td>
<td>60</td>
<td>Max additional patients for BA</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_63-phase-2-between-arm">6.3 Phase 2 (Between-Arm)<a class="anchor" aria-label="anchor" href="#id_63-phase-2-between-arm"></a></h3>
<table class="table"><colgroup><col width="22%"><col width="16%"><col width="14%"><col width="18%"><col width="27%"></colgroup><thead><tr class="header"><th>Parameter</th>
<th>Symbol</th>
<th>Range</th>
<th>Default</th>
<th>Description</th>
</tr></thead><tbody><tr class="odd"><td>BA efficacy</td>
<td>eff_ba</td>
<td>[0.95, 0.999]</td>
<td>0.975</td>
<td>Posterior prob threshold for BA efficacy</td>
</tr><tr class="even"><td>BA futility</td>
<td>fut_ba</td>
<td>[0.01, 0.10]</td>
<td>0.05</td>
<td>Posterior prob threshold for BA futility</td>
</tr><tr class="odd"><td>Min events</td>
<td>ev_ba</td>
<td>[10, 35]</td>
<td>15</td>
<td>Minimum events before BA interim</td>
</tr><tr class="even"><td>Max N</td>
<td>nmax_ba</td>
<td>[40, 100]</td>
<td>80</td>
<td>Maximum N in BA phase per arm</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_64-structural">6.4 Structural<a class="anchor" aria-label="anchor" href="#id_64-structural"></a></h3>
<table class="table"><colgroup><col width="22%"><col width="16%"><col width="14%"><col width="18%"><col width="27%"></colgroup><thead><tr class="header"><th>Parameter</th>
<th>Symbol</th>
<th>Range</th>
<th>Default</th>
<th>Description</th>
</tr></thead><tbody><tr class="odd"><td>PWE intervals</td>
<td>n_intervals</td>
<td>[4, 12]</td>
<td>8</td>
<td>Number of piecewise intervals</td>
</tr><tr class="even"><td>Prior strength</td>
<td>prior_strength</td>
<td>[0.15, 0.60]</td>
<td>0.45</td>
<td>Gamma prior concentration</td>
</tr></tbody></table><hr></div>
</div>
<div class="section level2">
<h2 id="id_7-operating-characteristics">7. Operating Characteristics<a class="anchor" aria-label="anchor" href="#id_7-operating-characteristics"></a></h2>
<div class="section level3">
<h3 id="id_71-primary-metrics">7.1 Primary Metrics<a class="anchor" aria-label="anchor" href="#id_71-primary-metrics"></a></h3>
<table class="table"><thead><tr class="header"><th>Metric</th>
<th>Definition</th>
<th>Constraint</th>
</tr></thead><tbody><tr class="odd"><td>power</td>
<td>P(reject H0 in SA or BA) under H1</td>
<td>&gt;= 0.80</td>
</tr><tr class="even"><td>type1</td>
<td>P(reject H0 in SA or BA) under H0</td>
<td>&lt;= 0.10</td>
</tr><tr class="odd"><td>type1_between</td>
<td>P(BA efficacy) under null_between</td>
<td>&lt;= 0.05</td>
</tr><tr class="even"><td>EN_total</td>
<td>Expected total N across phases</td>
<td>minimize</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_72-secondary-metrics">7.2 Secondary Metrics<a class="anchor" aria-label="anchor" href="#id_72-secondary-metrics"></a></h3>
<table class="table"><colgroup><col width="27%"><col width="41%"><col width="31%"></colgroup><thead><tr class="header"><th>Metric</th>
<th>Definition</th>
<th>Purpose</th>
</tr></thead><tbody><tr class="odd"><td>P_conversion</td>
<td>P(proceed to BA phase)</td>
<td>&gt;= 0.10 (ensure BA evaluation)</td>
</tr><tr class="even"><td>P_eff_sa</td>
<td>P(SA efficacy) under H1</td>
<td>Monitor SA stopping</td>
</tr><tr class="odd"><td>P_fut_sa</td>
<td>P(SA futility) under H0</td>
<td>Monitor early stopping</td>
</tr><tr class="even"><td>EN_sa</td>
<td>Expected N in SA phase</td>
<td>Cost analysis</td>
</tr><tr class="odd"><td>EN_ba_cond</td>
<td>Expected N in BA phase given conversion</td>
<td>Cost analysis</td>
</tr><tr class="even"><td>ET_total</td>
<td>Expected trial duration</td>
<td>Timeline planning</td>
</tr></tbody></table><hr></div>
</div>
<div class="section level2">
<h2 id="id_8-calibration-scenarios">8. Calibration Scenarios<a class="anchor" aria-label="anchor" href="#id_8-calibration-scenarios"></a></h2>
<div class="section level3">
<h3 id="id_81-null-scenarios-type-i-error-control">8.1 Null Scenarios (Type I Error Control)<a class="anchor" aria-label="anchor" href="#id_81-null-scenarios-type-i-error-control"></a></h3>
<p><strong>null_global</strong>: Both arms equal to historical</p>
<pre><code><span><span class="va">true_hr_vs_hist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1.0</span>, B <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="va">true_hr_between</span> <span class="op">=</span> <span class="fl">1.0</span></span></code></pre>
<p><strong>null_between</strong>: Both beat historical, no BA difference</p>
<pre><code><span><span class="va">true_hr_vs_hist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">0.8</span>, B <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">true_hr_between</span> <span class="op">=</span> <span class="fl">1.0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="id_82-alternative-scenarios-power">8.2 Alternative Scenarios (Power)<a class="anchor" aria-label="anchor" href="#id_82-alternative-scenarios-power"></a></h3>
<p><strong>alt_both_different</strong>: A better than B, both beat historical</p>
<pre><code><span><span class="va">true_hr_vs_hist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">0.67</span>, B <span class="op">=</span> <span class="fl">0.89</span><span class="op">)</span></span>
<span><span class="va">true_hr_between</span> <span class="op">=</span> <span class="fl">0.75</span></span></code></pre>
<p><strong>alt_strong_difference</strong>: Strong BA difference</p>
<pre><code><span><span class="va">true_hr_vs_hist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">0.6</span>, B <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="va">true_hr_between</span> <span class="op">=</span> <span class="fl">0.6</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="id_83-edge-cases">8.3 Edge Cases<a class="anchor" aria-label="anchor" href="#id_83-edge-cases"></a></h3>
<p><strong>one_arm_futile</strong>: One arm futile</p>
<pre><code><span><span class="va">true_hr_vs_hist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">0.67</span>, B <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="va">true_hr_between</span> <span class="op">=</span> <span class="fl">0.55</span></span></code></pre>
<hr></div>
</div>
<div class="section level2">
<h2 id="id_9-baton-integration">9. BATON Integration<a class="anchor" aria-label="anchor" href="#id_9-baton-integration"></a></h2>
<div class="section level3">
<h3 id="id_91-objective-function">9.1 Objective Function<a class="anchor" aria-label="anchor" href="#id_91-objective-function"></a></h3>
<pre><code>objective = EN_total + conversion_penalty_weight × P_conversion_under_null_between</code></pre>
<p><strong>Rationale</strong>: Penalize unnecessary conversions when SA succeeds but BA shouldn’t.</p>
</div>
<div class="section level3">
<h3 id="id_92-constraints">9.2 Constraints<a class="anchor" aria-label="anchor" href="#id_92-constraints"></a></h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ge"</span>, <span class="fl">0.80</span><span class="op">)</span>,</span>
<span>  type1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"le"</span>, <span class="fl">0.10</span><span class="op">)</span>,</span>
<span>  type1_between <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"le"</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  P_conversion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ge"</span>, <span class="fl">0.10</span><span class="op">)</span>,</span>
<span>  P_eff_sa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"le"</span>, <span class="fl">0.40</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_93-warmstart-budget">9.3 Warmstart Budget<a class="anchor" aria-label="anchor" href="#id_93-warmstart-budget"></a></h3>
<table class="table"><thead><tr class="header"><th>Stage</th>
<th>Budget</th>
<th>Purpose</th>
</tr></thead><tbody><tr class="odd"><td>Stage 1</td>
<td>250</td>
<td>Exploration (14D)</td>
</tr><tr class="even"><td>Stage 2</td>
<td>200</td>
<td>Refinement (10D after fixing structural)</td>
</tr><tr class="odd"><td>Stage 3</td>
<td>150</td>
<td>Validation (7-8D)</td>
</tr></tbody></table><hr></div>
</div>
<div class="section level2">
<h2 id="id_10-implementation-files">10. Implementation Files<a class="anchor" aria-label="anchor" href="#id_10-implementation-files"></a></h2>
<div class="section level3">
<h3 id="id_101-evolvetrial-package">10.1 evolveTrial Package<a class="anchor" aria-label="anchor" href="#id_101-evolvetrial-package"></a></h3>
<table class="table"><thead><tr class="header"><th>File</th>
<th>Purpose</th>
</tr></thead><tbody><tr class="odd"><td><code>R/hybrid_trial.R</code></td>
<td>Core simulator with 4-state machine</td>
</tr><tr class="even"><td><code>R/hybrid_ssr.R</code></td>
<td>Predictive/posterior SSR methods</td>
</tr><tr class="odd"><td><code>R/hybrid_decisions.R</code></td>
<td>SA/BA decision rules, trigger logic</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_102-baton-integration">10.2 BATON Integration<a class="anchor" aria-label="anchor" href="#id_102-baton-integration"></a></h3>
<table class="table"><thead><tr class="header"><th>File</th>
<th>Purpose</th>
</tr></thead><tbody><tr class="odd"><td><code>R/warmstart_wrappers.R</code></td>
<td><code>create_hybrid_wrapper_simple()</code></td>
</tr><tr class="even"><td><code>R/scenario_configs.R</code></td>
<td>Hybrid bounds, constraints</td>
</tr><tr class="odd"><td><code>R/aggregation.R</code></td>
<td>Hybrid metrics aggregation</td>
</tr><tr class="even"><td><code>R/hybrid_calibration_scenarios.R</code></td>
<td>5 calibration scenarios</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_103-testing">10.3 Testing<a class="anchor" aria-label="anchor" href="#id_103-testing"></a></h3>
<table class="table"><colgroup><col width="40%"><col width="60%"></colgroup><thead><tr class="header"><th>File</th>
<th>Purpose</th>
</tr></thead><tbody><tr class="odd"><td><code>tests/testthat/test-hybrid-simulator.R</code></td>
<td>Parameter validation, state transitions</td>
</tr><tr class="even"><td><code>tests/testthat/test-hybrid-ssr.R</code></td>
<td>PP algorithms</td>
</tr><tr class="odd"><td><code>tests/testthat/test-hybrid-integration.R</code></td>
<td>Full BO calibration</td>
</tr></tbody></table><hr></div>
</div>
<div class="section level2">
<h2 id="id_11-validation-strategy">11. Validation Strategy<a class="anchor" aria-label="anchor" href="#id_11-validation-strategy"></a></h2>
<div class="section level3">
<h3 id="id_111-unit-tests">11.1 Unit Tests<a class="anchor" aria-label="anchor" href="#id_111-unit-tests"></a></h3>
<ul><li>Closed-form F-distribution matches MC for exponential case</li>
<li>State transitions occur correctly</li>
<li>PP increases with sample size</li>
<li>PP approaches 1 when true effect is large</li>
<li>PP approaches 0 when true effect is null</li>
</ul></div>
<div class="section level3">
<h3 id="id_112-regression-tests">11.2 Regression Tests<a class="anchor" aria-label="anchor" href="#id_112-regression-tests"></a></h3>
<ul><li>Hybrid with <code>pp_go=1.0</code> matches pure SA design</li>
<li>Hybrid with instant conversion matches pure BA design</li>
<li>Type I error controlled across scenarios</li>
</ul></div>
<div class="section level3">
<h3 id="id_113-integration-tests">11.3 Integration Tests<a class="anchor" aria-label="anchor" href="#id_113-integration-tests"></a></h3>
<ul><li>Full BO calibration completes without errors</li>
<li>CSV loading and wrapper creation work correctly</li>
<li>Parallel execution produces consistent results</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="id_12-recommended-defaults-for-adapt">12. Recommended Defaults for ADAPT<a class="anchor" aria-label="anchor" href="#id_12-recommended-defaults-for-adapt"></a></h2>
<p>For the ARPA-H ADAPT breast cancer platform trial:</p>
<ol style="list-style-type: decimal"><li>
<strong>SSR method</strong>: Predictive probability</li>
<li>
<strong>Conversion trigger</strong>: <code>any_single_success</code>
</li>
<li>
<strong>Thresholds</strong>: <code>pp_go=0.70</code>, <code>pp_nogo=0.20</code>
</li>
<li>
<strong>Futility action</strong>: <code>drop_arm</code>
</li>
<li>
<strong>P_conversion constraint</strong>: &gt;= 0.10</li>
<li>
<strong>HR threshold</strong>: 0.80 (20% improvement)</li>
</ol><hr><p><strong>Document maintained by</strong>: evolveTrial development team <strong>Last updated</strong>: 2025-12-20</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Naim Rashid.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

