% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulation_driver.R
\name{run_simulation_pure}
\alias{run_simulation_pure}
\title{Run a full set of evolveTrial simulations for a design specification}
\usage{
run_simulation_pure(
  num_simulations,
  arm_names,
  reference_arm_name,
  compare_arms_option,
  weibull_shape_true_arms,
  weibull_median_true_arms,
  null_median_arms = NULL,
  futility_median_arms = NULL,
  interval_cutpoints_sim,
  max_follow_up_sim,
  censor_max_time_sim,
  prior_alpha_params_model,
  prior_beta_params_model,
  num_posterior_draws,
  num_posterior_draws_interim = NULL,
  cohort_size_per_arm,
  max_total_patients_per_arm,
  min_patients_for_analysis = NULL,
  efficacy_stopping_rule_hc = FALSE,
  efficacy_threshold_current_prob_hc = NULL,
  posterior_futility_threshold_hc = NULL,
  efficacy_threshold_hc_prob = NULL,
  futility_threshold_hc_prob = NULL,
  futility_stopping_rule_hc = FALSE,
  efficacy_stopping_rule_vs_ref = FALSE,
  futility_stopping_rule_vs_ref = FALSE,
  efficacy_threshold_vs_ref_prob = NULL,
  futility_threshold_vs_ref_prob = NULL,
  compare_arms_futility_margin = 0,
  compare_arms_hr_margin = NULL,
  use_ph_model_vs_ref = FALSE,
  ph_loghr_prior_mean = 0,
  ph_loghr_prior_sd = 1,
  median_pfs_success_threshold_arms = NULL,
  final_success_posterior_prob_threshold = 0.85,
  median_pfs_futility_threshold_arms = NULL,
  final_futility_posterior_prob_threshold = 0.85,
  overall_accrual_rate,
  randomization_probs,
  min_follow_up_at_final = 0,
  max_trial_time = Inf,
  min_events_for_analysis = NULL,
  min_median_followup = NULL,
  min_events_hc = NULL,
  min_median_followup_hc = NULL,
  interim_calendar_beat = 2,
  diagnostics = FALSE,
  pred_success_pp_threshold_hc = 1,
  pred_futility_pp_threshold_hc = 0,
  num_posterior_draws_pred = 100,
  predictive_fast = FALSE,
  min_events_per_arm = NULL,
  min_median_followup_per_arm = NULL,
  min_person_time_frac_per_arm = 0,
  person_time_milestones = NULL,
  latest_calendar_look = Inf,
  rebalance_after_events = NULL,
  parallel_replicates = FALSE,
  num_workers = NULL,
  cluster_type = c("auto", "PSOCK", "FORK"),
  cluster = NULL,
  progress = interactive(),
  return_percentiles = FALSE,
  percentile_probs = c(0, 0.25, 0.5, 0.75, 0.9, 1)
)
}
\arguments{
\item{num_simulations}{Number of Monte Carlo replicates to run.}

\item{arm_names}{Character vector naming the trial arms.}

\item{reference_arm_name}{Character scalar naming the control/reference arm.}

\item{compare_arms_option}{Logical; \code{TRUE} evaluates vs-reference logic,
\code{FALSE} evaluates arms independently against historical control targets.}

\item{weibull_shape_true_arms}{Named numeric vector of Weibull shape
parameters under the truth.}

\item{weibull_median_true_arms}{Named numeric vector of true median PFS
(months) for each arm.}

\item{null_median_arms}{Named numeric vector of null (historical control)
medians used for single-arm evaluations.}

\item{futility_median_arms}{Named numeric vector of futility medians for
single-arm logic.}

\item{interval_cutpoints_sim}{Numeric vector of interval boundaries (months)
for piecewise exponential modelling.}

\item{max_follow_up_sim}{Maximum administrative follow-up time (months).}

\item{censor_max_time_sim}{Upper bound for random censoring draws (months).}

\item{prior_alpha_params_model}{Numeric vector of Gamma prior shape
parameters for the piecewise exponential hazards.}

\item{prior_beta_params_model}{Numeric vector of Gamma prior rate parameters
for the piecewise exponential hazards.}

\item{num_posterior_draws}{Number of posterior draws used for final analyses.}

\item{num_posterior_draws_interim}{Optional integer overriding the number of
posterior draws used at interim looks.}

\item{cohort_size_per_arm}{Size of each enrolment batch per arm (typically 1).}

\item{max_total_patients_per_arm}{Named integer vector of per-arm sample size
caps.}

\item{min_patients_for_analysis}{Minimum number of patients required to
evaluate an arm in the single-arm path. If not specified, defaults to 0,
allowing interim analyses to occur even with very few patients. Set this
to a higher value to prevent interim analyses until a certain number of
patients have been enrolled.}

\item{efficacy_stopping_rule_hc}{Logical; enable interim efficacy checks for
the historical-control path.}

\item{efficacy_threshold_current_prob_hc}{\strong{DEPRECATED}. Use
\code{efficacy_threshold_hc_prob} instead. Interim success probability
threshold for single-arm logic.}

\item{posterior_futility_threshold_hc}{\strong{DEPRECATED}. Use
\code{futility_threshold_hc_prob} instead. Interim futility probability
threshold for single-arm logic.}

\item{efficacy_threshold_hc_prob}{Interim success probability threshold for
single-arm logic (preferred harmonized name).}

\item{futility_threshold_hc_prob}{Interim futility probability threshold for
single-arm logic (preferred harmonized name).}

\item{futility_stopping_rule_hc}{Logical; enable interim futility checks for
the single-arm path.}

\item{efficacy_stopping_rule_vs_ref}{Logical; enable interim efficacy checks
for the vs-reference path.}

\item{futility_stopping_rule_vs_ref}{Logical; enable interim futility checks
for the vs-reference path.}

\item{efficacy_threshold_vs_ref_prob}{Posterior superiority threshold for
vs-reference decisions.}

\item{futility_threshold_vs_ref_prob}{Posterior inferiority threshold for
vs-reference decisions.}

\item{compare_arms_futility_margin}{Absolute median difference used when
defining vs-reference futility.}

\item{compare_arms_hr_margin}{Optional hazard-ratio margin used when
\code{use_ph_model_vs_ref = TRUE}.}

\item{use_ph_model_vs_ref}{Logical; use the proportional-hazards joint model
for vs-reference comparisons.}

\item{ph_loghr_prior_mean}{Mean of the normal prior on the log hazard ratio
(PH model).}

\item{ph_loghr_prior_sd}{Standard deviation of the normal prior on the log
hazard ratio.}

\item{median_pfs_success_threshold_arms}{Named numeric vector of median PFS
thresholds for declaring final success per arm.}

\item{final_success_posterior_prob_threshold}{Posterior probability threshold
for final success declarations.}

\item{median_pfs_futility_threshold_arms}{Named numeric vector of median PFS
futility thresholds for final analyses.}

\item{final_futility_posterior_prob_threshold}{Posterior probability
threshold for final futility declarations.}

\item{overall_accrual_rate}{Expected accrual rate (patients per month).}

\item{randomization_probs}{Named numeric vector of randomisation probabilities.}

\item{min_follow_up_at_final}{Additional follow-up (months) required after
last enrolment before the final analysis.}

\item{max_trial_time}{Maximum calendar time (months) for the entire trial.
After this cutoff from trial start, the trial terminates regardless of
other stopping rules. Default is \code{Inf} (no time limit).}

\item{min_events_for_analysis}{\strong{DEPRECATED}. Use \code{min_events_hc}
instead. Minimum events required for interim review (global gate).}

\item{min_median_followup}{\strong{DEPRECATED}. Use \code{min_median_followup_hc}
instead. Minimum median follow-up required for interim review (global gate).}

\item{min_events_hc}{Minimum events required for single-arm interim review
(preferred harmonized name).}

\item{min_median_followup_hc}{Minimum median follow-up required for single-arm
interim review (preferred harmonized name).}

\item{interim_calendar_beat}{Calendar spacing (months) between scheduled
interim looks when person-time milestones are not used.}

\item{diagnostics}{Logical; if \code{TRUE} prints interim diagnostic messages.}

\item{pred_success_pp_threshold_hc}{Predictive probability threshold for
interim success in the single-arm predictive look (if enabled).}

\item{pred_futility_pp_threshold_hc}{Predictive probability threshold for
interim futility in the single-arm predictive look (if enabled).}

\item{num_posterior_draws_pred}{Number of posterior draws used inside
predictive probability calculations.}

\item{predictive_fast}{Logical; switch to the analytic predictive
approximations.}

\item{min_events_per_arm}{Optional per-arm minimum event gate for vs-reference.}

\item{min_median_followup_per_arm}{Optional per-arm minimum median follow-up
gate for vs-reference.}

\item{min_person_time_frac_per_arm}{Optional per-arm proportion of planned
person-time required before evaluating vs-reference decisions.}

\item{person_time_milestones}{Optional numeric vector (fractions of total
planned person-time) triggering interim looks.}

\item{latest_calendar_look}{Backstop calendar time for person-time schedules.}

\item{rebalance_after_events}{Optional integer; when non-\code{NULL} the piecewise
cut points are re-estimated once that number of events has accrued.}

\item{parallel_replicates}{Logical; if \code{TRUE}, distribute Monte Carlo
replicates across a parallel cluster.}

\item{num_workers}{Optional integer specifying the number of workers when
\code{parallel_replicates = TRUE}. Defaults to \code{parallel::detectCores() - 1}.}

\item{cluster_type}{Type of parallel cluster to spawn when distributing
replicates. One of \code{"auto"} (default, uses FORK on Unix, PSOCK on Windows),
\code{"PSOCK"}, or \code{"FORK"}. FORK clusters are faster on Linux/macOS as they
share memory and don't require package loading in workers.}

\item{cluster}{Optional pre-existing parallel cluster to reuse. When provided,
the cluster is used for parallel execution and NOT stopped on exit. This
enables cluster pooling for repeated calls (e.g., in Bayesian optimization).
Create with \code{evolveTrial::create_simulation_cluster()} or \code{parallel::makeCluster()}.}

\item{progress}{Logical; show the simulation progress bar when running
sequentially. Automatically disabled for parallel replicate execution.}

\item{return_percentiles}{Logical; if \code{TRUE}, store per-replicate sample sizes
and return percentile summaries in addition to means. Default \code{FALSE}.}

\item{percentile_probs}{Numeric vector of probabilities for percentile
computation when \code{return_percentiles = TRUE}. Default \code{c(0, 0.25, 0.5, 0.75, 0.9, 1.0)}
gives min, 25th, median, 75th, 90th, and max.}
}
\value{
When \code{return_percentiles = FALSE} (default), a data frame with one row
per arm and columns summarising operating characteristics such as type I
error / power, PETs, final decision probabilities, expected sample size,
expected events, and expected trial duration (calendar months).
When \code{return_percentiles = TRUE}, a list with two elements:
\describe{
\item{summary}{The same data frame as when \code{return_percentiles = FALSE}}
\item{percentiles}{A list with elements \code{N} (named list of percentile vectors
per arm) and \code{probs} (the probability values used)}
}
}
\description{
\code{run_simulation_pure()} is the workhorse simulator for evolveTrial.  It
enrols patients according to the supplied accrual plan, applies interim
gating/decision rules, optionally rebalances interval cut points, and
carries each replicate forward to the final analysis.  Operating
characteristics are returned summarised per arm.
}
\details{
When \code{parallel_replicates = TRUE}, results will vary based on
\code{num_workers} due to different random number stream partitioning.
For exact reproducibility across runs, use \code{parallel_replicates = FALSE}.

During package development with \code{devtools::load_all()}, parallel workers
will load the installed package version, not the development code. For
testing development changes, either use \code{parallel_replicates = FALSE} or
reinstall the package with \code{devtools::install()}.
}
